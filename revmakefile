main = main.f90
benchmark = Benchmarks/benchmark.f90
benchgen = Benchmarks/generate_benchmark.f90

#lib and other stuff to include to the compiler 
incs = -I ./fftw/fftw_comp/include/ -ffree-line-length-none
libs = -L ./fftw/fftw_comp/lib/ -lfftw3 -lm \
	-L ${HEADAS}/lib/ -lfftw3 -lm\
	-lXSFunctions -lcfitsio -lXSModel -lXSUtil -lXS -lCCfits_2.5 #note: older heasoft versions may need lCCfits_2.5 to compile
fitsio = 
optimization = -O3
debug        = -Wall -pedantic


# set compilers
fcomp = gfortran $(optimization) #$(debug) 
ccomp = gcc      $(optimization) 

# the files to compile 
FCODE = $(main) srevtrans.f90
CCODE = relmodels.c rellp.c relbase.c reltable.c relutility.c donthcomp.c xilltable.c relcache.c
FTEST = $(benchmark) srevtrans.f90
FGEN  = $(benchgen) srevtrans.f90

CBENCH = Benchmarks/setenv.c 

mod:
	$(fcomp) $(incs) $(libs) -c amodules.f90
fobj: $(FCODE)
	$(fcomp) -c $(FCODE)
ftest: $(FTEST)
	$(fcomp) -c $(FTEST)
fgen: $(FGEN)
	$(fcomp) -c $(FGEN)

cobj: 
	$(ccomp) -c $(CCODE)
cbench: 
	$(ccomp) -c $(CBENCH)

compile: mod fobj cobj
	 $(fcomp) -fno-second-underscore -fno-automatic -fPIC $(incs) *.o -o main $(libs)

benchmark: mod ftest cobj cbench 
	 $(fcomp) -fno-second-underscore -fno-automatic -fPIC $(incs) *.o -o benchmark $(libs)
	 
genbench: mod fgen cobj cbench 
	 $(fcomp) -fno-second-underscore -fno-automatic -fPIC $(incs) *.o -o genbench $(libs)
	 
main: clean compile cleanup

test: clean benchmark cleanup

gen: clean genbench cleanup

clean:
	rm -vf *.o *.mod *~ subroutines/*~
cleanup:
	rm -vf *.o *.mod *~ subroutines/*~
